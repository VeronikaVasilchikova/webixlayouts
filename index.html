<!DOCTYPE HTML>
<html>
    <head>
      <link rel="stylesheet" href="https://cdn.webix.com/edge/webix.css" type="text/css">
      <script src="https://cdn.webix.com/edge/webix.js" type="text/javascript"></script>
      <script src="menudata.js" type="text/javascript"></script>
      <script src="testdata.js" type="text/javascript"></script>
      <script src="formEditFilmsData.js" type="text/javascript"></script>
      <link rel="stylesheet" href="style.css" type="text/css">
    </head>
    <body>
      <script type="text/javascript" charset="utf-8">

        webix.ready(function(){

          webix.ui({
            view:"popup",
            id:"popupBtnToolbar",
            width:200,
            body:{
              view:"list",
              data:[
                "Settings",
                "Log Out"
              ],
              autoheight:true,
              select:true
            }
          });

          let toolbar = {
            view:"toolbar",
            css:"webix_dark",
            height:40,
            paddingX:10,
            elements:[
              {
                view:"label",
                label:"My App"
              },
              {},
              {
                view:"button",
                id:"btnToolbar",
                type:"icon",
                icon:"wxi-user",
                label:"Profile",
                width: 100,
                css:"webix_transparent",
                popup:"popupBtnToolbar"
              }
            ]
          };

          let menu = {
            width:180,
            minWidth:150,
            css:"gray_menu",
            rows:[
              {
                view:"list",
                template:"#value#",
                data:menu_data,
                scroll:false,
              },
              {},
              {
                template:"<span class='webix_icon wxi-check'></span> Connected",
                height:30,
                type:"clean",
                css:"green_template"
              }
            ]
          };

          let datatable = {
            view:"datatable",
            id:"filmList",
            scroll:"y",
            columns: [
              {
                id:"title",
                header:"Title",
                fillspace:true
              },
              {
                id:"year",
                header:"Year"
              },
              {
                id:"votes",
                header:"Votes"
              },
              {
                id:"rating",
                header:"Rating"
              },
              {
                id:"rank",
                header:"Rank"
              }
            ],
            data:small_film_set
          };

          let form = {
            view:"form",
            id:"editFilms",
            width:280,
            paddingX:25,
            elements:form_edit_films_data,
            rules:{
              title: webix.rules.isNotEmpty,
              year:function(value) {
                const today = new Date();
                const currentYear = today.getFullYear();
                //console.log(this.config.width);
                //this.config.width = 400;
                return value > 1970 && value < currentYear;
              },
              rating:function(value) {
                return !value || value != 0;
              },
              votes:function(value) {
                return value < 100000;
              }
            }
          };

          webix.ui({
            rows:[
              toolbar,
              {cols:[menu, {view:"resizer"}, datatable, form]},
              {template:"The software is provided by <a href='https://webix.com' target='_blank'>https://webix.com</a>. All rights reserved (c)", css:"template_footer", height:30}
            ],
          });

          $$("btnAddNew").attachEvent("onItemClick", function() {
            if ($$("editFilms").validate()) {
              webix.message("Your data has been successfully entered!");
              const formData = $$("editFilms").getValues();
              $$("filmList").add(formData);
            } else {
              $$('editFilms').config.width = 400;
              $$('editFilms').resize();
            }
          });

          $$("btnClear").attachEvent("onItemClick", function() {
            webix.confirm({
              title: "Clear this form",
              text: "Are you sure you want to clear this form?",
              callback: function(result) {
                if (result) {
                  $$("editFilms").clear();
                  $$("editFilms").clearValidation();
                }
              }
            })
            .then(
              function(){
                  webix.message("Form cleaning is confirmed");
              },
              function(){
                  webix.message("Form cleaning is rejected");
              }
            );
          });

        });

      </script>

    </body>
</html>
